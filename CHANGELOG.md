# Changelog

All notable changes to the **Mouse4** project will be documented in this file.

## [V58.0] - 2026-01-21 (Stability & Recovery)
### Added
- **热键复活**: 在托盘右键菜单新增“**重置快捷键**”选项。针对电脑睡眠/休眠唤醒后快捷键可能失效的系统特性，提供一键手动修复方案，无需重启程序。

### Fixed
- **启动修复**: 回退了 V56/V57 尝试使用的原生热键注册机制（因在无界面模式下导致程序静默崩溃），回归至最稳健的 V54 架构。
- **误触防护**: 保留并优化了 `GetAsyncKeyState` 物理按键检测逻辑，确保在 Excel/股票软件中输入数字（如 "712"）时绝不误触截图。

## [V55.0] - 2026-01-21 (Experimental)
### Fixed
- **误触修复**: 尝试解决快速输入数字时的误触问题（已被 V58 继承并优化）。
- **底层优化**: 引入 Win32 API 进行物理按键检测。

## [V54.0] - 2026-01-16 (Multi-Monitor Final)
### Changed
- **多屏恢复**: 恢复全屏蒙版支持。现在按下快捷键时，所有连接的显示器都会同时变暗，支持在任意屏幕上截图。

## [V53.0] - 2026-01-16 (High-DPI Fix)
### Fixed
- **缩放修复**: 修复在 4K/200% 缩放屏幕上，鼠标拖拽选区时内容被错误放大（"Zoomed In" 现象）的问题。
### Changed
- **核心渲染**: 弃用 Qt 自动 DPR 处理，改为手动计算物理像素与逻辑坐标的缩放因子 (`scale_factor`)，确保截图在混合分辨率屏幕下严丝合缝。

## [V52.0] - 2026-01-16
### Fixed
- **分辨率修复**: 解决禁用 DPI 感知导致 4K 屏幕被系统虚拟为 1080p（画面模糊、壁纸变小）的问题。
### Added
- **DPI 策略**: 重新启用 `SetProcessDpiAwarenessContext`，并添加 `HighDpiScaleFactorRoundingPolicy` 以防止 1px 像素偏差。

## [V48.0 - V51.0] - 2026-01-16 (Coordinates & Debugging)
### Fixed
- **多屏错位**: 修复在股票软件等复杂多屏环境下，截图窗口坐标偏移或出现黑边的问题。
### Changed
- **坐标逻辑**: 截图引擎从依赖窗口 `geometry()` 改为强制使用屏幕 `screen_info` 的绝对物理坐标。
- **窗口绑定**: 强制使用 `setScreen` 将截图窗口锚定在鼠标所在的物理显示器上。

---

## [V47.0] - 2026-01-13 (Latest)
### Fixed
- **UI Bug**: 修复了工具栏分割线变量名引用错误导致的程序闪退问题 (Critical Hotfix)。
- **交互优化**: 移除文字输入框的默认占位符，点击屏幕即显示空白光标，不再出现默认字符。

### Changed
- **UI 细节**: 工具栏分隔符从字符 `|` 升级为专业的垂直分割线 (`QFrame`)，视觉更加整洁。

## [V46.0] - 2026-01-13
### Changed
- **UI 适配**: 加宽字号下拉框宽度，解决大字号数字显示不全的问题。
- **图标美化**: 字号选择器右侧图标替换为自定义的 SVG 上下箭头 (⇵) 样式，更具现代感。

## [V45.0] - 2026-01-13
### Fixed
- **Crash Fix**: 补全缺失的 `show_toolbar` 定位函数，修复截图完成时的崩溃问题。

### Added
- **功能增强**: 文字工具升级为下拉菜单选择，支持 12px-72px 多档字号，且支持实时预览调整。

## [V42.0] - 2026-01-13
### Added
- **核心升级**: 实现“原地文字输入” (Overlay Input)，点击屏幕直接出现透明输入框，所见即所得，回车确认。

### Changed
- **UI 重塑**: 工具栏全面升级为深色磨砂质感，图标尺寸加大，颜色选择器增加选中光圈特效。

### Fixed
- **Bug 修复**: 彻底解决箭头工具计算坐标时的类型错误 (`TypeError`) 崩溃问题。

## [V41.0] - 2026-01-13
### Added
- **核心重构**: 引入“屏幕定格”机制，截图触发瞬间画面静止，提供稳定的绘图画布。
- **新增工具**: 新增悬浮标注工具栏，包含矩形 (⬜)、圆形 (⭕)、箭头 (↗)、画笔 (✎) 及撤销 (↶) 功能。
- **体验优化**: 支持右键单击取消当前选中的绘图工具，再次右键退出截图。

---

## [V40.0] - 2026-01-05
### Added
- **UI 美化**: 新增自动圆角裁剪算法。
- **图标优化**: 实现 `logo.ico` 在托盘显示时自动变为圆形，且支持打包命令将图标内置。

## [V39.0]
### Fixed
- **高清修复**: 引入像素密度比 (DPR) 计算，修复 2K/4K 高分屏缩放下截图尺寸偏小的问题。
- **层级修复**: 截图窗口改为 `showFullScreen`，强制覆盖任务栏，解决无法截取任务栏的问题。

## [V38.0]
### Removed
- **极简版**: 移除“设置双击速度”功能及菜单入口。
- **菜单精简**: 托盘菜单仅保留：GitHub、右键管理、退出。

## [V37.0]
### Changed
- **功能调整**: 移除热键设置功能，截图热键固定为 `Ctrl+1`。

## [V36.0]
### Added
- **尝试**: 新增按键录制窗口（*后因需求变更撤销*）。

## [V35.0]
### Fixed
- **打包修复**: 增加 `resource_path` 资源定位函数。
- **Bug 修复**: 解决打包为单文件 (`-F`) 后，托盘图标无法读取导致显示默认图标的问题。

## [V34.0]
### Fixed
- **核心修复**: 重写 `RegistryManager`，增加 EXE 环境判断 (`sys.frozen`)。
- **Bug 修复**: 解决打包后右键菜单找不到程序路径导致功能失效的问题。

## [V33.0]
### Changed
- **文案修正**: 统一菜单术语（“设置截图热键”、“设置返回上一层文件夹双击速度”）。

## [V32.0]
### Added
- **新增**: 托盘菜单增加“访问 GitHub 主页”选项。
- **依赖**: 引入 `webbrowser` 模块。

## [V31.0]
### Changed
- **体验优化**: 移除右键存图成功后的弹窗提示，实现“静默保存”。

## [V30.0]
### Added
- **功能找回**: 恢复丢失的“设置双击速度”功能及托盘入口。
### Changed
- **优化**: 优化托盘菜单结构。

## [V29.0]
### Fixed
- **基准修复**: 修复注册表写入权限问题，解决右键菜单偶尔失效的 Bug。

---

## 早期版本 (Early Access)

### [V25.0 - V28.0]
- **功能完善**: 完善右键菜单逻辑，增加 `--paste` 启动参数。
- **调试**: 增加诊断弹窗（用于调试剪贴板读取失败等问题）。

### [V22.0]
- **框架重构**: GUI 框架从 `tkinter`/`pystray` 全面迁移至 **PyQt6**。
- **UI**: 界面美化，增加半透明遮罩效果。

### [V20.0]
- **新增功能**: 初步尝试“右键菜单”集成。
- **核心**: 编写注册表写入逻辑，支持右键调用脚本。

### [V15.0]
- **核心升级**: 截图引擎从 `PIL` 迁移至 `mss`，支持多显示器截图。

### [V11.0 - V14.0]
- **新增功能**: 集成截图模块。
- **支持**: 添加默认截图快捷键支持。

### [V10.0]
- **UI 重构**: 移除 CMD 黑框运行模式。
- **核心**: 加入系统托盘图标（Tray Icon），程序最小化到后台运行。

### [V5.0 - V9.0]
- **智能识别**: 引入 `UIAutomation` 库，实现“空白处”智能识别，防止双击文件时触发返回。
- **配置**: 增加 `config.json` 配置文件支持。

### [V2.0 - V4.0]
- **优化**: 优化双击判定逻辑，解决单击误触问题。
- **限制**: 引入 `is_explorer_window` 判断，限制仅在资源管理器生效。

### [V1.0]
- **项目初始化**。
- **基础功能**: 监听鼠标左键双击。
- **核心逻辑**: 发送 `Alt+Up` 模拟返回上一级。