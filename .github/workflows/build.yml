name: Auto Build Windows Exe

# 触发机制：当 main 分支有代码 push (上传) 时触发
on:
  push:
    branches: [ "main" ]
  workflow_dispatch: # 允许你手动点击按钮触发

jobs:
  build:
    runs-on: windows-latest # 指定使用微软最新的 Windows 服务器环境

    steps:
    - name: Checkout code (拉取代码)
      uses: actions/checkout@v4

    - name: Set up Python (安装 Python环境)
      uses: actions/setup-python@v5
      with:
        python-version: '3.10' # 推荐用 3.10，兼容性好

    - name: Install dependencies (安装依赖库)
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: Build with PyInstaller (开始打包)
      # --noconsole: 不显示黑框
      # --onefile: 打包成单文件
      # --name: 软件的名字
      run: |
        pyinstaller --noconsole --onefile --name "MouseMaster" main.py

    - name: Upload Artifact (上传结果供下载)
      uses: actions/upload-artifact@v4
      with:
        name: MouseMaster-Software # 下载时的压缩包名字
        path: dist/MouseMaster.exe # 打包好的文件路径
        retention-days: 5 # 文件保留5天，过期自动清理
